import sqlite3

# Función para conectar a la base de datos
def conectar_db():
    return sqlite3.connect("inventario.db")

# Función para inicializar la base de datos
def inicializar_bd():
    try:
        conn = conectar_db()
        cursor = conn.cursor()
        # Crear la tabla celulares con la columna stock
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS celulares (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                marca TEXT NOT NULL,
                modelo TEXT NOT NULL,
                almacenamiento TEXT NOT NULL,
                precio REAL NOT NULL,
                stock INTEGER NOT NULL DEFAULT 0,  # Nueva columna para el stock
                UNIQUE(marca, modelo, almacenamiento)
            )
        ''')
        conn.commit()
        print("Tabla 'celulares' creada correctamente.")
    except sqlite3.Error as e:
        print(f"Error al inicializar la base de datos: {e}")
    finally:
        if conn:
            conn.close()

# Función para insertar datos de ejemplo
def insertar_datos():
    productos_celulares = [
        # (marca, modelo, almacenamiento, precio, stock)
        ("Samsung", "Galaxy S23", "128GB", 799.99, 5),
        ("Apple", "iPhone 15", "256GB", 999.99, 3),
        ("Xiaomi", "Redmi Note 12", "128GB", 299.99, 10),
        ("Google", "Pixel 7", "128GB", 599.99, 7),
        ("OnePlus", "OnePlus 11", "256GB", 699.99, 4),
        ("Samsung", "Galaxy Z Fold 4", "256GB", 1799.99, 3),
        ("Apple", "iPhone 14 Pro", "512GB", 1199.99, 6),
        ("Xiaomi", "Mi 11 Lite", "128GB", 349.99, 8),
        ("Google", "Pixel 6a", "128GB", 449.99, 9),
        ("Motorola", "Moto G Power", "64GB", 249.99, 12)
    ]
    
    try:
        conn = conectar_db()
        cursor = conn.cursor()
        # Verificar si ya hay datos en la tabla
        cursor.execute("SELECT COUNT(*) FROM celulares")
        count = cursor.fetchone()[0]
        if count == 0:
            # Insertar datos con el stock
            cursor.executemany("INSERT INTO celulares (marca, modelo, almacenamiento, precio, stock) VALUES (?, ?, ?, ?, ?)", productos_celulares)
            conn.commit()
            print("Datos de ejemplo insertados correctamente.")
        else:
            print("La tabla ya tiene datos. No se insertaron nuevos datos.")
    except sqlite3.Error as e:
        print(f"Error al insertar datos: {e}")
    finally:
        if conn:
            conn.close()

if __name__ == "__main__":
    # Inicializar la base de datos y agregar datos de ejemplo
    inicializar_bd()
    insertar_datos()
    print("Base de datos inicializada y datos insertados correctamente.")